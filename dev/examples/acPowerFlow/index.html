<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AC Power Flow · JuliaGrid</title><meta name="title" content="AC Power Flow · JuliaGrid"/><meta property="og:title" content="AC Power Flow · JuliaGrid"/><meta property="twitter:title" content="AC Power Flow · JuliaGrid"/><meta name="description" content="Documentation for JuliaGrid."/><meta property="og:description" content="Documentation for JuliaGrid."/><meta property="twitter:description" content="Documentation for JuliaGrid."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/tablestyle.css" rel="stylesheet" type="text/css"/><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="JuliaGrid logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JuliaGrid</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/powerSystemModel/">Power System Model</a></li><li><a class="tocitem" href="../../manual/acPowerFlow/">AC Power Flow</a></li><li><a class="tocitem" href="../../manual/dcPowerFlow/">DC Power Flow</a></li><li><a class="tocitem" href="../../manual/acOptimalPowerFlow/">AC Optimal Power Flow</a></li><li><a class="tocitem" href="../../manual/dcOptimalPowerFlow/">DC Optimal Power Flow</a></li><li><a class="tocitem" href="../../manual/measurementModel/">Measurement Model</a></li><li><a class="tocitem" href="../../manual/acStateEstimation/">AC State Estimation</a></li><li><a class="tocitem" href="../../manual/pmuStateEstimation/">PMU State Estimation</a></li><li><a class="tocitem" href="../../manual/dcStateEstimation/">DC State Estimation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/powerSystemModel/">Power System Model</a></li><li><a class="tocitem" href="../../tutorials/acPowerFlow/">AC Power Flow</a></li><li><a class="tocitem" href="../../tutorials/dcPowerFlow/">DC Power Flow</a></li><li><a class="tocitem" href="../../tutorials/acOptimalPowerFlow/">AC Optimal Power Flow</a></li><li><a class="tocitem" href="../../tutorials/dcOptimalPowerFlow/">DC Optimal Power Flow</a></li><li><a class="tocitem" href="../../tutorials/measurementModel/">Measurement Model</a></li><li><a class="tocitem" href="../../tutorials/acStateEstimation/">AC State Estimation</a></li><li><a class="tocitem" href="../../tutorials/pmuStateEstimation/">PMU State Estimation</a></li><li><a class="tocitem" href="../../tutorials/dcStateEstimation/">DC State Estimation</a></li><li><a class="tocitem" href="../../tutorials/perunit/">Per-Unit System</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../powerSystemCase/">Power System Test Case</a></li><li class="is-active"><a class="tocitem" href>AC Power Flow</a><ul class="internal"><li><a class="tocitem" href="#Base-Case-Analysis"><span>Base Case Analysis</span></a></li><li><a class="tocitem" href="#Modifying-Generators-and-Demands"><span>Modifying Generators and Demands</span></a></li><li><a class="tocitem" href="#Modifying-Power-System-Topology"><span>Modifying Power System Topology</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/powerSystemModel/">Power System Model</a></li><li><a class="tocitem" href="../../api/powerFlow/">Power Flow</a></li><li><a class="tocitem" href="../../api/optimalPowerFlow/">Optimal Power Flow</a></li><li><a class="tocitem" href="../../api/measurementModel/">Measurement Model</a></li><li><a class="tocitem" href="../../api/stateEstimation/">State Estimation</a></li><li><a class="tocitem" href="../../api/analysis/">Power and Current Analysis</a></li><li><a class="tocitem" href="../../api/setupPrint/">Setup and Print</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Background</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../background/installation/">Installation Guide</a></li><li><a class="tocitem" href="../../background/bibliography/">Bibliography</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>AC Power Flow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>AC Power Flow</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mcosovic/JuliaGrid.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mcosovic/JuliaGrid.jl/blob/master/docs/src/examples/acPowerFlow.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ACPowerFlowExamples"><a class="docs-heading-anchor" href="#ACPowerFlowExamples">AC Power Flow</a><a id="ACPowerFlowExamples-1"></a><a class="docs-heading-anchor-permalink" href="#ACPowerFlowExamples" title="Permalink"></a></h1><p>In this example, we will perform several AC power flow analyses, effectively simulating quasi-steady-state conditions where the power system undergoes parameter and topology changes. These examples demonstrate JuliaGrid&#39;s efficiency in handling such scenarios.</p><p>Using the previously created <a href="../powerSystemCase/#PowerSystemTestCaseExamples">power system test case</a>, we begin by defining the bus parameters for AC power flow analysis. This includes specifying the <code>type</code> of each bus and the connected <code>active</code> and <code>reactive</code> power loads. The initial bus voltage values default to <code>magnitude = 1.0</code> and <code>angle = 0.0</code>, but users can modify these values if needed:</p><pre><code class="language-julia hljs">updateBus!(system; label = &quot;Bus 1&quot;, type = 3)
updateBus!(system; label = &quot;Bus 2&quot;, type = 1, magnitude = 0.91, angle = -0.01)
updateBus!(system; label = &quot;Bus 3&quot;, type = 2, active = 0.2, reactive = 0.1)
updateBus!(system; label = &quot;Bus 4&quot;, type = 1, active = 0.5, reactive = 0.2)</code></pre><p>Next, we enhance the transmission line parameters by including additional details such as <code>resistance</code>, <code>susceptance</code>, and the transformer off-nominal turns ratio specified using the <code>turnsRatio</code> keyword:</p><pre><code class="language-julia hljs">updateBranch!(system; label = &quot;Branch 1&quot;, resistance = 0.02, susceptance = 0.05)
updateBranch!(system; label = &quot;Branch 2&quot;, resistance = 0.05, susceptance = 0.04)
updateBranch!(system; label = &quot;Branch 3&quot;, resistance = 0.04, susceptance = 0.04)
updateBranch!(system; label = &quot;Branch 4&quot;, turnsRatio = 0.98)</code></pre><p>Finally, we define the <code>active</code> and <code>reactive</code> power outputs of the generators and set the voltage magnitude setpoints, with the default value being <code>magnitude = 1.0</code> unless specified otherwise:</p><pre><code class="language-julia hljs">updateGenerator!(system; label = &quot;Generator 1&quot;, active = 2.3, reactive = 0.4)
updateGenerator!(system; label = &quot;Generator 2&quot;, active = 0.4, magnitude = 1.1)</code></pre><p>Now, we create an AC model that includes power system topology and parameters, as well as the nodal admittance matrix. Once generated for a specific power system, this model can be shared across different analyses and is automatically updated when power system data changes:</p><pre><code class="language-julia hljs">acModel!(system)</code></pre><hr/><h5 id="AC-Power-Flow-Analysis-Wrapper-Function"><a class="docs-heading-anchor" href="#AC-Power-Flow-Analysis-Wrapper-Function">AC Power Flow Analysis Wrapper Function</a><a id="AC-Power-Flow-Analysis-Wrapper-Function-1"></a><a class="docs-heading-anchor-permalink" href="#AC-Power-Flow-Analysis-Wrapper-Function" title="Permalink"></a></h5><p>We can define a wrapper function to perform AC power flow analysis. Using JuliaGrid&#39;s built-in functions, this function computes bus voltage magnitudes and angles. Once the algorithm converges, it then calculates the powers associated with buses, branches, and generators:</p><pre><code class="language-julia hljs">function acPowerFlow!(system::PowerSystem, analysis::ACPowerFlow)
    for iteration = 1:20
        stopping = mismatch!(system, analysis)
        if all(stopping .&lt; 1e-8)
            println(&quot;The algorithm converged in $(iteration - 1) iterations.&quot;)
            break
        end
        solve!(system, analysis)
    end
    power!(system, analysis)
end</code></pre><hr/><h2 id="Base-Case-Analysis"><a class="docs-heading-anchor" href="#Base-Case-Analysis">Base Case Analysis</a><a id="Base-Case-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Base-Case-Analysis" title="Permalink"></a></h2><p>At the start, we use the fast Newton-Raphson XB method to solve the AC power flow. This method is chosen because we intend to modify generator and demand parameters. JuliaGrid efficiently reuses the factorization of Jacobian matrices in these cases, which significantly reduces computational complexity. Therefore, we define the model for this method:</p><pre><code class="language-julia hljs">fnr = fastNewtonRaphsonXB(system)</code></pre><p>Next, we run the iterative algorithm to calculate bus voltages and active and reactive powers:</p><pre><code class="language-julia hljs">acPowerFlow!(system, fnr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">The algorithm converged in 9 iterations.</code></pre><p>Once the AC power flow is solved, we can analyze the results related to the buses. For instance:</p><pre><code class="language-julia hljs">printBusData(system, fnr; show = Dict(&quot;Shunt Power&quot; =&gt; false))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">|------------------------------------------------------------------------------------------|
| Bus Data                                                                                 |
|------------------------------------------------------------------------------------------|
| Label |       Voltage       | Power Generation  |   Power Demand    |  Power Injection   |
|       |                     |                   |                   |                    |
|   Bus | Magnitude |   Angle | Active | Reactive | Active | Reactive |  Active | Reactive |
|       |      [pu] |   [rad] |   [pu] |     [pu] |   [pu] |     [pu] |    [pu] |     [pu] |
|-------|-----------|---------|--------|----------|--------|----------|---------|----------|
| Bus 1 |    1.0000 |  0.0000 | 0.3229 |  -0.6929 | 0.0000 |   0.0000 |  0.3229 |  -0.6929 |
| Bus 2 |    1.0053 | -0.0248 | 0.0000 |   0.0000 | 0.0000 |   0.0000 | -0.0000 |  -0.0000 |
| Bus 3 |    1.1000 | -0.0152 | 0.4000 |   1.0579 | 0.2000 |   0.1000 |  0.2000 |   0.9579 |
| Bus 4 |    0.9439 | -0.1908 | 0.0000 |   0.0000 | 0.5000 |   0.2000 | -0.5000 |  -0.2000 |
|------------------------------------------------------------------------------------------|</code></pre><p>Among the active and reactive power values, we now focus on the power flows at the from-bus and to-bus ends of the branches. The results are:</p><pre><code class="language-julia hljs">show = Dict(&quot;Shunt Power&quot; =&gt; false, &quot;Series Power&quot; =&gt; false)
printBranchData(system, fnr; show)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">|---------------------------------------------------------------------------------|
| Branch Data                                                                     |
|---------------------------------------------------------------------------------|
|            Label             |   From-Bus Power   |    To-Bus Power    | Status |
|                              |                    |                    |        |
|   Branch | From-Bus | To-Bus |  Active | Reactive |  Active | Reactive |        |
|          |          |        |    [pu] |     [pu] |    [pu] |     [pu] |        |
|----------|----------|--------|---------|----------|---------|----------|--------|
| Branch 1 | Bus 1    | Bus 2  |  0.3488 |  -0.2248 | -0.3456 |   0.1842 |      1 |
| Branch 2 | Bus 1    | Bus 3  | -0.0259 |  -0.4681 |  0.0359 |   0.4682 |      1 |
| Branch 3 | Bus 2    | Bus 3  | -0.1544 |  -0.4884 |  0.1641 |   0.4897 |      1 |
| Branch 4 | Bus 2    | Bus 4  |  0.5000 |   0.3042 | -0.5000 |  -0.2000 |      1 |
|---------------------------------------------------------------------------------|</code></pre><hr/><h2 id="Modifying-Generators-and-Demands"><a class="docs-heading-anchor" href="#Modifying-Generators-and-Demands">Modifying Generators and Demands</a><a id="Modifying-Generators-and-Demands-1"></a><a class="docs-heading-anchor-permalink" href="#Modifying-Generators-and-Demands" title="Permalink"></a></h2><p>We will modify the active and reactive power outputs of the generators, as well as the active and reactive powers demanded by consumers. Instead of creating a new power system model or just updating the existing one, we will update both the power system model and the fast Newton-Raphson model simultaneously:</p><pre><code class="language-julia hljs">updateBus!(system, fnr; label = &quot;Bus 3&quot;, type = 2, active = 0.3, reactive = 0.0)
updateBus!(system, fnr; label = &quot;Bus 4&quot;, type = 1, active = 0.1, reactive = 0.1)

updateGenerator!(system, fnr; label = &quot;Generator 1&quot;, active = 2.0, reactive = 0.2)
updateGenerator!(system, fnr; label = &quot;Generator 2&quot;, active = 1.2, reactive = 0.2)</code></pre><p>Next, we run the AC power flow again to compute the new state of the power system, without having to recreate the fast Newton-Raphson model. Additionally, this step will start the fast Newton-Raphson method with a warm start, as the initial voltage magnitudes and angles will correspond to the solution from the base case analysis:</p><pre><code class="language-julia hljs">acPowerFlow!(system, fnr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">The algorithm converged in 6 iterations.</code></pre><p>Finally, we can display the relevant data:</p><pre><code class="language-julia hljs">printBranchData(system, fnr; show)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">|---------------------------------------------------------------------------------|
| Branch Data                                                                     |
|---------------------------------------------------------------------------------|
|            Label             |   From-Bus Power   |    To-Bus Power    | Status |
|                              |                    |                    |        |
|   Branch | From-Bus | To-Bus |  Active | Reactive |  Active | Reactive |        |
|          |          |        |    [pu] |     [pu] |    [pu] |     [pu] |        |
|----------|----------|--------|---------|----------|---------|----------|--------|
| Branch 1 | Bus 1    | Bus 2  | -0.3215 |  -0.2768 |  0.3248 |   0.2357 |      1 |
| Branch 2 | Bus 1    | Bus 3  | -0.4485 |  -0.3588 |  0.4643 |   0.3841 |      1 |
| Branch 3 | Bus 2    | Bus 3  | -0.4248 |  -0.3420 |  0.4357 |   0.3486 |      1 |
| Branch 4 | Bus 2    | Bus 4  |  0.1000 |   0.1063 | -0.1000 |  -0.1000 |      1 |
|---------------------------------------------------------------------------------|</code></pre><hr/><h2 id="Modifying-Power-System-Topology"><a class="docs-heading-anchor" href="#Modifying-Power-System-Topology">Modifying Power System Topology</a><a id="Modifying-Power-System-Topology-1"></a><a class="docs-heading-anchor-permalink" href="#Modifying-Power-System-Topology" title="Permalink"></a></h2><p>Next, we will take <code>Branch 3</code> out of service. Although we could update the power system model and the fast Newton-Raphson method simultaneously, to demonstrate flexibility, we will solve this scenario using the Newton-Raphson method. As a result, we will only update the power system model:</p><pre><code class="language-julia hljs">updateBranch!(system; label = &quot;Branch 3&quot;, status = 0)</code></pre><p>Now, let us define the Newton-Raphson model:</p><pre><code class="language-julia hljs">nr = newtonRaphson(system)</code></pre><p>When the model is created, we also initialize the method, with the starting voltage magnitudes and angles corresponding to the values defined when the power system model was first created. If we want to use the results from the fast Newton-Raphson method and start the Newton-Raphson method with a warm start, we can transfer the voltage magnitudes and angles:</p><pre><code class="language-julia hljs">transferVoltage!(fnr, nr)</code></pre><p>Now, we can solve the power flow and calculate the powers for this scenario:</p><pre><code class="language-julia hljs">acPowerFlow!(system, nr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">The algorithm converged in 3 iterations.</code></pre><p>To display how the power flow is distributed when one branch is out of service, we use the following:</p><pre><code class="language-julia hljs">printBranchData(system, nr; show)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">|---------------------------------------------------------------------------------|
| Branch Data                                                                     |
|---------------------------------------------------------------------------------|
|            Label             |   From-Bus Power   |    To-Bus Power    | Status |
|                              |                    |                    |        |
|   Branch | From-Bus | To-Bus |  Active | Reactive |  Active | Reactive |        |
|          |          |        |    [pu] |     [pu] |    [pu] |     [pu] |        |
|----------|----------|--------|---------|----------|---------|----------|--------|
| Branch 1 | Bus 1    | Bus 2  |  0.1003 |   0.0580 | -0.1000 |  -0.1067 |      1 |
| Branch 2 | Bus 1    | Bus 3  | -0.8611 |  -0.2115 |  0.9000 |   0.3385 |      1 |
| Branch 3 | Bus 2    | Bus 3  |  0.0000 |   0.0000 |  0.0000 |   0.0000 |      0 |
| Branch 4 | Bus 2    | Bus 4  |  0.1000 |   0.1067 | -0.1000 |  -0.1000 |      1 |
|---------------------------------------------------------------------------------|</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../powerSystemCase/">« Power System Test Case</a><a class="docs-footer-nextpage" href="../../api/powerSystemModel/">Power System Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 30 January 2025 11:57">Thursday 30 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

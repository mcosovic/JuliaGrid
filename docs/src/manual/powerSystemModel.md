# [Power System Model](@id powerSystemModelManual)

The JuliaGrid supports the composite type `PowerSystem` to preserve power system data, with the following fields: `bus`, `branch`, `generator`, `base`, `acModel`, and `dcModel`. The fields `bus`, `branch`, and `generator` hold data related to buses, branches, and generators, respectively. The `base` field stores base values for power and voltages, with the default being three-phase power measured in volt-amperes (VA) for the base power and line-to-line voltages measured in volts (V) for base voltages. The macro command [`@base`](@ref @base) can be used to change the default unit settings for the base quantities of the composite type `PowerSystem` after it is created. 

The composite type `PowerSystem` can be created using a function:
* [`powerSystem`](@ref powerSystem).
JuliaGrid supports three modes for populating the `PowerSystem` type: using built-in functions, using HDF5 file format, and using [Matpower](https://matpower.org) case files. It is recommended to use the HDF5 format for large-scale systems. To facilitate this, JuliaGrid has the function:
* [`savePowerSystem`](@ref savePowerSystem).
This function allows to save power systems that were either loaded from Matpower case files or created using built-in functions in the HDF5 format.

Once the `PowerSystem` type is created, you can add buses, branches, and generators using the following functions:
* [`addBus!`](@ref addBus!)
* [`addBranch!`](@ref addBranch!)
* [`addGenerator!`](@ref addGenerator!).
In addition, it is possible to manipulate the parameters of buses, branches, and generators using the following functions:
* [`shuntBus!`](@ref shuntBus!)
* [`statusBranch!`](@ref statusBranch!)
* [`parameterBranch!`](@ref parameterBranch!)
* [`statusGenerator!`](@ref statusGenerator!)
* [`outputGenerator!`](@ref outputGenerator!).
Executing these functions will automatically update all fields affected by them. You can also change other parameters of the power system by accessing and modifying the values in the `bus`, `branch`, `generator`, and `base` fields of the `PowerSystem` composite type. The input electrical quantities should be entered in per-units or radians, but this default setting can be altered using the following macros [`@power`](@ref @power), [`@voltage`](@ref @voltage), and [`@parameter`](@ref @parameter).

After adding the generator, JualiGrid provides the following functions to incorporate costs for the active and reactive power generated by the generator: 
* [`addActiveCost!`](@ref addActiveCost!)
* [`addReactiveCost!`](@ref addReactiveCost!).

To create vectors and matrices based on the power system topology and parameters, you can use the following functions:
* [`acModel!`](@ref acModel!)
* [`dcModel!`](@ref dcModel!).
Note that these functions can be executed at any time once all power system buses are defined. Specifically, using the [`addBranch!`](@ref addBranch!) function to add a new branch will automatically update the `acModel` and `dcModel` fields. However, adding a new bus using [`addBus!`](@ref addBus!) requires executing the [`acModel!`](@ref acModel!) and [`dcModel!`](@ref dcModel!) functions again. In addition, executing functions related to parameter manipulation of buses and branches will also automatically update the `acModel` and `dcModel` fields.

---

## Build Model
The [`powerSystem`](@ref powerSystem) function generates a `PowerSystem` composite type and requires a string-formatted path to either HDF5 or Matpower case files as input. To create a `PowerSystem` type using the Matpower case file for the IEEE 14-bus test case, which is named `case14` and located in the folder `C:\matpower`, the following Julia code can be used:
```julia-repl
system = powerSystem("C:/matpower/case14.m")
```

Alternativly, the model can be build from the scratch using built-in functions, for example:
```@example buildModelScratch
using JuliaGrid # hide

system = powerSystem()

addBus!(system; label = 1, type = 3, active = 0.1, base = 138e3)
addBus!(system; label = 2, type = 1, reactive = 0.05, angle = -0.03491, base = 138e3)
addBus!(system; label = 3, type = 1, susceptance = 0.05, base = 138e3)

addBranch!(system; label = 1, from = 1, to = 2, reactance = 0.12, shiftAngle = 0.1745)
addBranch!(system; label = 2, from = 2, to = 3, resistance = 0.008, reactance = 0.05)
```

```jldoctest
a = 1
b = 2
a + b
```

All electrical quantities stored in `system` are in per-units (pu) and radians (rad), except for base values for power and voltages, which are given in volt-amperes (VA) and volts (V), respectively:
```@example buildModelScratch
system.base.power.value, system.base.power.unit
system.base.voltage.value, system.base.voltage.unit
```
```jldoctest buildModelScratch
julia> system.base.voltage.value, system.base.voltage.unit
```

```julia-repl
julia> system.base.power.value, system.base.power.unit
(1.0e8, "VA")
julia> system.base.voltage.value, system.base.voltage.unit
([138000.0, 138000.0, 138000.0, ..., 138000.0, 138000.0, 138000.0], "V")
```

If the user is more familiar with megavolt-amperes (MVA) and kilovolts (kV), for instance, the units can be changed with the following command:
```julia-repl
@base(system, MVA, kV)
```
This macro results in the following values:
```julia-repl
julia> system.base.power.value, system.base.power.unit
(100.0, "MVA")
julia> system.base.voltage.value, system.base.voltage.unit
([138.0, 138.0, 138.0, ..., 138.0, 138.0, 138.0], "kV")
```

By changing the base unit, the user can adjust the output data from various analyses to units other than per-units and radians.